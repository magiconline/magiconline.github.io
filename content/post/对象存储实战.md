---
title: "对象存储实战"
date: 2022-06-05T15:45:02+08:00
draft: false
---

# 抖音背后的存储
## 存储需求
1. 上传视频
2. 存储原视频
3. 1. 转码，存储不同码率视频
   2. 抽帧，存储图片，审核
4. 推荐服务
5. 下载视频、图片

需要易用、海量、便宜的存储。

# 为什么对象存储
## 存储系统分类
1. 单机存储：文件系统，kv存储
2. 单机数据库：关系型数据库、非关系型数据库
3. 分布式数据库：关系型数据库、非关系型数据库
4. 分布式存储：分布式文件系统、对象存储

## 存储系统对比

| 存储备选 | 海量支持 | 适合数据类型 |
| --- | --- | --- |
| 单机存储 | No | 单机文件、KV |
| 单机数据库 | No | 少量结构化、半结构化数据 |
| 分布式数据库 | Yes | 大量结构化、半结构化数据 | 
| 分布式存储 | Yes | 大数据计算中间结果、视频、图片等 | 

## 分布式存储选型

| | 海量 | 易用 | 便宜 |
| --- | --- | --- | --- |
|分布式文件系统HDFS | 支持PB、EB海量存储；文件数量受Name Node 限制 | 伪Posix文件接口，开发复杂；非云原生，搭建维护麻烦；视频、图片相关生态接入复杂 | 使用普通X86服务器，成本低 | 
| 对象存储 | 支持EB海量存储；对象数量无限制 | Restful 接口，开发简单；云原生，按需申请使用；视频、图片相关生态丰富 | 使用普通X86服务器；具备冷热数据分级存储能力，成本更低 |

## 适用场景
静态文件
- 视频
- 图片
- 文本
- 安装包
- 备份
- 前端js文件


# 对象存储怎么用
申请Bucket -> 业务理论逻辑开发 -> 上线测试

## Restful 接口
- PUT
  - 参数: Bucket, key, 对象内容
  - 返回: 成功/失败
- GET：
  - 参数：Bucket，key
  - 返回：对象内容
- HEAD：
  - 参数：Bucket，key
  - 返回：对象元信息
- DELETE：
  - 参数：Bucket，key
  - 返回：成功/失败


# TOS字节内部实践
## 开发一个对象存储
- 容量型
  - 代表业务：片源、转码
  - 特点：容量大、吞吐大、高持久度
  - 挑战：可扩展性、成本、持久度
- QPS型
  - 代表业务：抽帧
  - 特点：QPS高
  - 挑战：可扩展性

## 可扩展性 - Partition
分布式存储 = 分布式 + 单机存储  
分布式：计算、存储、压力均匀分布  

## 持久度 - Replication
复制：
- 多副本
- 多机架
- 多机房
- 多地区

## 成本
冗余编码：可达到和多副本一样的持久度，成本更低，增加了额外的编码计算步骤。  
冷热转换：SSD -> HDD -> 磁带、光盘

## 高可用
镜像灾备、拆分到多集群