<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>GORM实践 - 魔法张的Blog</title><meta name=description content="1 简介 1.1 DB连接的几种类型 直接连接/Conn
预编译/Stmt
事务/Tx
1.2 处理返回数据的几种方法 Result
Rows
Row
2 GORM 2.1 CRUD 操作数据库
// 创建 db.AutoMigrate(&Product{}) db.Migrator().CreateTable(&Product{})   // 插入 db.Create(&user)   // 读取 db.First(&product) db.Find(&users, []int{1,2,3})  // 更新 db.Model(&product).Update(&#34;Price&#34;, 200)   // 删除 db.Delete(&product) 2.2 Model 定义 2.3 惯例约定 2.4 关联操作 3 GORM 设计原理 3.1 SQL生成 SQL是怎么生成的
SELECT * FROM * WHERE * ORDERBY * LIMIT * FOR * // 必选：SELECT FROM // 可选：WHERE ORDERBY LIMIT db."><meta name=author content><link rel="preload stylesheet" as=style href=https://magiconline.github.io/app.min.css><link rel="preload stylesheet" as=style href=https://magiconline.github.io/an-old-hope.min.css><script defer src=https://magiconline.github.io/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://magiconline.github.io/theme.png><link rel=preload as=image href=https://magiconline.github.io/github.svg><link rel=icon href=https://magiconline.github.io/favicon.ico><link rel=apple-touch-icon href=https://magiconline.github.io/apple-touch-icon.png><meta name=generator content="Hugo 0.99.1"><meta property="og:title" content="GORM实践"><meta property="og:description" content="1 简介 1.1 DB连接的几种类型 直接连接/Conn
预编译/Stmt
事务/Tx
1.2 处理返回数据的几种方法 Result
Rows
Row
2 GORM 2.1 CRUD 操作数据库
// 创建 db.AutoMigrate(&Product{}) db.Migrator().CreateTable(&Product{})   // 插入 db.Create(&user)   // 读取 db.First(&product) db.Find(&users, []int{1,2,3})  // 更新 db.Model(&product).Update(&#34;Price&#34;, 200)   // 删除 db.Delete(&product) 2.2 Model 定义 2.3 惯例约定 2.4 关联操作 3 GORM 设计原理 3.1 SQL生成 SQL是怎么生成的
SELECT * FROM * WHERE * ORDERBY * LIMIT * FOR * // 必选：SELECT FROM // 可选：WHERE ORDERBY LIMIT db."><meta property="og:type" content="article"><meta property="og:url" content="https://magiconline.github.io/post/gorm%E5%AE%9E%E8%B7%B5/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-05-16T14:53:41+08:00"><meta property="article:modified_time" content="2022-05-16T14:53:41+08:00"><meta itemprop=name content="GORM实践"><meta itemprop=description content="1 简介 1.1 DB连接的几种类型 直接连接/Conn
预编译/Stmt
事务/Tx
1.2 处理返回数据的几种方法 Result
Rows
Row
2 GORM 2.1 CRUD 操作数据库
// 创建 db.AutoMigrate(&Product{}) db.Migrator().CreateTable(&Product{})   // 插入 db.Create(&user)   // 读取 db.First(&product) db.Find(&users, []int{1,2,3})  // 更新 db.Model(&product).Update(&#34;Price&#34;, 200)   // 删除 db.Delete(&product) 2.2 Model 定义 2.3 惯例约定 2.4 关联操作 3 GORM 设计原理 3.1 SQL生成 SQL是怎么生成的
SELECT * FROM * WHERE * ORDERBY * LIMIT * FOR * // 必选：SELECT FROM // 可选：WHERE ORDERBY LIMIT db."><meta itemprop=datePublished content="2022-05-16T14:53:41+08:00"><meta itemprop=dateModified content="2022-05-16T14:53:41+08:00"><meta itemprop=wordCount content="95"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="GORM实践"><meta name=twitter:description content="1 简介 1.1 DB连接的几种类型 直接连接/Conn
预编译/Stmt
事务/Tx
1.2 处理返回数据的几种方法 Result
Rows
Row
2 GORM 2.1 CRUD 操作数据库
// 创建 db.AutoMigrate(&Product{}) db.Migrator().CreateTable(&Product{})   // 插入 db.Create(&user)   // 读取 db.First(&product) db.Find(&users, []int{1,2,3})  // 更新 db.Model(&product).Update(&#34;Price&#34;, 200)   // 删除 db.Delete(&product) 2.2 Model 定义 2.3 惯例约定 2.4 关联操作 3 GORM 设计原理 3.1 SQL生成 SQL是怎么生成的
SELECT * FROM * WHERE * ORDERBY * LIMIT * FOR * // 必选：SELECT FROM // 可选：WHERE ORDERBY LIMIT db."></head><body class=not-ready data-menu=true><header class=header><p class=logo><a class=site-name href=https://magiconline.github.io/>魔法张的Blog</a><a class=btn-dark></a></p><script>let bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>{bodyClx[e?"add":"remove"]("dark"),localStorage.setItem("dark",e?"yes":"no")};setDark(darkVal?darkVal==="yes":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",e=>setDark(e.matches))</script><nav class=menu><a href=/about/>About</a></nav><nav class=social><a class=github style=--url:url(./github.svg) href=https://github.com/magiconline target=_blank></a></nav></header><main class=main><article class=post-single><header class=post-title><p><time>May 16, 2022</time></p><h1>GORM实践</h1></header><section class=post-content><h1 id=1-简介>1 简介</h1><h2 id=11-db连接的几种类型>1.1 DB连接的几种类型</h2><p>直接连接/Conn</p><p>预编译/Stmt</p><p>事务/Tx</p><h2 id=12-处理返回数据的几种方法>1.2 处理返回数据的几种方法</h2><p>Result</p><p>Rows</p><p>Row</p><h1 id=2-gorm>2 GORM</h1><h2 id=21-crud>2.1 CRUD</h2><p>操作数据库</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 创建
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>AutoMigrate</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Product</span>{})
</span></span><span style=display:flex><span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Migrator</span>().<span style=color:#a6e22e>CreateTable</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Product</span>{})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 插入
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Create</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 读取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>First</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>product</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Find</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>users</span>, []<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>3</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 更新
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Model</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>product</span>).<span style=color:#a6e22e>Update</span>(<span style=color:#e6db74>&#34;Price&#34;</span>, <span style=color:#ae81ff>200</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 删除
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Delete</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>product</span>)
</span></span></code></pre></div><h2 id=22-model-定义>2.2 Model 定义</h2><h2 id=23-惯例约定>2.3 惯例约定</h2><h2 id=24-关联操作>2.4 关联操作</h2><h1 id=3-gorm-设计原理>3 GORM 设计原理</h1><h2 id=31-sql生成>3.1 SQL生成</h2><p>SQL是怎么生成的</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>WHERE</span> <span style=color:#f92672>*</span> ORDERBY <span style=color:#f92672>*</span> <span style=color:#66d9ef>LIMIT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FOR</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>//</span> <span style=color:#960050;background-color:#1e0010>必选：</span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>FROM</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>//</span> <span style=color:#960050;background-color:#1e0010>可选：</span><span style=color:#66d9ef>WHERE</span> ORDERBY <span style=color:#66d9ef>LIMIT</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Where</span>().<span style=color:#a6e22e>Where</span>().<span style=color:#a6e22e>Limit</span>().<span style=color:#a6e22e>Order</span>().<span style=color:#a6e22e>Find</span>()
</span></span><span style=display:flex><span><span style=color:#75715e>// Chain Method + Finisher Method
</span></span></span></code></pre></div><h2 id=32-插件扩展>3.2 插件扩展</h2><p>Callbacks</p><h2 id=33-connpool>3.3 ConnPool</h2><h2 id=34-dialector>3.4 Dialector</h2><h1 id=4-gorm-最佳实践>4 GORM 最佳实践</h1><h2 id=41-最佳实践>4.1 最佳实践</h2><p>数据序列化与SQL表达式</p><p>批量数据操作</p><p>关闭默认事务</p><p>SkipHooks</p><p>Prepare Statement</p><p>代码分页、分库分表</p><p>混沌工程、压测</p></section><nav class=post-nav><a class=next href=https://magiconline.github.io/post/go%E8%AF%AD%E8%A8%80%E4%BC%98%E5%8C%96%E4%B8%8E%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/><span>Go语言优化与落地实践</span><span>→</span></a></nav></article></main><footer class=footer><p>&copy; 2022 <a href=https://magiconline.github.io/>魔法张的Blog</a></p><p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p><p><a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a></p></footer></body></html>