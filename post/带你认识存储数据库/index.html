<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>带你认识存储数据库 - 魔法张的Blog</title><meta name=description content="经典案例 数据的持久化 校验数据的合法性 修改内存（用高效的数据结构组织数据） 写入存储介质（以寿命&性能友好的方式写入硬件） 潜在问题 数据库怎么保证数据不丢 数据库怎么处理多人同时修改的问题 为什么用数据库，除了数据库还能存到别的存储系统吗 数据库只能处理结构化数据吗 有哪些操作数据库的方式，要用什么编程语言 存储 & 数据库简介 存储系统 一个提供了读写、控制类接口，能够安全有效地把数据持久化的软件，就可以称为存储系统。
特点：性能敏感、代码简单又复杂、容易受硬件影响。
数据库 关系：任意元素组成的若干有序偶对
SQL：一种DSL，方便人类阅读的关系代数的表达形式
关系型数据库 数据化结构友好、支持事务、支持复杂查询语言SQL。
非关系型数据库 一般不要求严格的结构化。 半结构化数据友好、可能支持事务、可能支持复杂查询语言。
数据库 VS 经典存储 结构化数据关系 关系型数据库以表形式管理。
写入文件，自定义行，管理结构。
事务能力 数据库支持事务：
Atomicity：事务内的操作要么全做，要么不做。 Consistency，事务执行前后，数据状态是一致的。 Isolation，可以隔离多个并发事务，避免影响。 Durability，事务一旦提交成功，数据保证持久性。 复杂查询能力 SQL VS 编程语言
主流产品剖析 单机存储 单机存储：单个计算机节点上的存储软件系统，一般不涉及网络交互。
本地文件系统 文件系统接口：Ext2/3/4，sysfs，rootfs等，都遵循VFS的统一抽象接口。
Index Node: 记录文件元数据，如ID，大小、权限、位置等。inode是一个文件的唯一标识，会被存储到磁盘上，inode的总数在格式化文件系统时就固定了。 Directory Entry: 记录文件名、inode指针、层级关系等。dentry是内存结构，与inode的关系是N:1。
key-value存储 使用方式: put(k, v) & get(k) 常见的数据结构：LSM-Tree 产品：rocksdb
分布式存储 分布式存储：在单机存储基础上实现了分布式协议，涉及大量网络交互。
分布式文件系统 HDFS，Ceph
单机关系型数据库 Oracle、MySQL、PostgreSQL。
通用组件：
Query Engine：解析query，生成查询计划 Txn Manager：负责事务并发管理 Lock Manager：负责锁相关的策略 Storage Engine：负责组织内存、磁盘数据结构 Replication：负责主备同步 关键内存数据结构：B-Tree、B+-Tree、LRU List"><meta name=author content><link rel="preload stylesheet" as=style href=https://magiconline.github.io/app.min.css><link rel="preload stylesheet" as=style href=https://magiconline.github.io/an-old-hope.min.css><script defer src=https://magiconline.github.io/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://magiconline.github.io/theme.png><link rel=preload as=image href=https://magiconline.github.io/github.svg><link rel=icon href=https://magiconline.github.io/favicon.ico><link rel=apple-touch-icon href=https://magiconline.github.io/apple-touch-icon.png><meta name=generator content="Hugo 0.100.1"><meta property="og:title" content="带你认识存储数据库"><meta property="og:description" content="经典案例 数据的持久化 校验数据的合法性 修改内存（用高效的数据结构组织数据） 写入存储介质（以寿命&性能友好的方式写入硬件） 潜在问题 数据库怎么保证数据不丢 数据库怎么处理多人同时修改的问题 为什么用数据库，除了数据库还能存到别的存储系统吗 数据库只能处理结构化数据吗 有哪些操作数据库的方式，要用什么编程语言 存储 & 数据库简介 存储系统 一个提供了读写、控制类接口，能够安全有效地把数据持久化的软件，就可以称为存储系统。
特点：性能敏感、代码简单又复杂、容易受硬件影响。
数据库 关系：任意元素组成的若干有序偶对
SQL：一种DSL，方便人类阅读的关系代数的表达形式
关系型数据库 数据化结构友好、支持事务、支持复杂查询语言SQL。
非关系型数据库 一般不要求严格的结构化。 半结构化数据友好、可能支持事务、可能支持复杂查询语言。
数据库 VS 经典存储 结构化数据关系 关系型数据库以表形式管理。
写入文件，自定义行，管理结构。
事务能力 数据库支持事务：
Atomicity：事务内的操作要么全做，要么不做。 Consistency，事务执行前后，数据状态是一致的。 Isolation，可以隔离多个并发事务，避免影响。 Durability，事务一旦提交成功，数据保证持久性。 复杂查询能力 SQL VS 编程语言
主流产品剖析 单机存储 单机存储：单个计算机节点上的存储软件系统，一般不涉及网络交互。
本地文件系统 文件系统接口：Ext2/3/4，sysfs，rootfs等，都遵循VFS的统一抽象接口。
Index Node: 记录文件元数据，如ID，大小、权限、位置等。inode是一个文件的唯一标识，会被存储到磁盘上，inode的总数在格式化文件系统时就固定了。 Directory Entry: 记录文件名、inode指针、层级关系等。dentry是内存结构，与inode的关系是N:1。
key-value存储 使用方式: put(k, v) & get(k) 常见的数据结构：LSM-Tree 产品：rocksdb
分布式存储 分布式存储：在单机存储基础上实现了分布式协议，涉及大量网络交互。
分布式文件系统 HDFS，Ceph
单机关系型数据库 Oracle、MySQL、PostgreSQL。
通用组件：
Query Engine：解析query，生成查询计划 Txn Manager：负责事务并发管理 Lock Manager：负责锁相关的策略 Storage Engine：负责组织内存、磁盘数据结构 Replication：负责主备同步 关键内存数据结构：B-Tree、B+-Tree、LRU List"><meta property="og:type" content="article"><meta property="og:url" content="https://magiconline.github.io/post/%E5%B8%A6%E4%BD%A0%E8%AE%A4%E8%AF%86%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E5%BA%93/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-06-03T14:13:26+08:00"><meta property="article:modified_time" content="2022-06-03T14:13:26+08:00"><meta itemprop=name content="带你认识存储数据库"><meta itemprop=description content="经典案例 数据的持久化 校验数据的合法性 修改内存（用高效的数据结构组织数据） 写入存储介质（以寿命&性能友好的方式写入硬件） 潜在问题 数据库怎么保证数据不丢 数据库怎么处理多人同时修改的问题 为什么用数据库，除了数据库还能存到别的存储系统吗 数据库只能处理结构化数据吗 有哪些操作数据库的方式，要用什么编程语言 存储 & 数据库简介 存储系统 一个提供了读写、控制类接口，能够安全有效地把数据持久化的软件，就可以称为存储系统。
特点：性能敏感、代码简单又复杂、容易受硬件影响。
数据库 关系：任意元素组成的若干有序偶对
SQL：一种DSL，方便人类阅读的关系代数的表达形式
关系型数据库 数据化结构友好、支持事务、支持复杂查询语言SQL。
非关系型数据库 一般不要求严格的结构化。 半结构化数据友好、可能支持事务、可能支持复杂查询语言。
数据库 VS 经典存储 结构化数据关系 关系型数据库以表形式管理。
写入文件，自定义行，管理结构。
事务能力 数据库支持事务：
Atomicity：事务内的操作要么全做，要么不做。 Consistency，事务执行前后，数据状态是一致的。 Isolation，可以隔离多个并发事务，避免影响。 Durability，事务一旦提交成功，数据保证持久性。 复杂查询能力 SQL VS 编程语言
主流产品剖析 单机存储 单机存储：单个计算机节点上的存储软件系统，一般不涉及网络交互。
本地文件系统 文件系统接口：Ext2/3/4，sysfs，rootfs等，都遵循VFS的统一抽象接口。
Index Node: 记录文件元数据，如ID，大小、权限、位置等。inode是一个文件的唯一标识，会被存储到磁盘上，inode的总数在格式化文件系统时就固定了。 Directory Entry: 记录文件名、inode指针、层级关系等。dentry是内存结构，与inode的关系是N:1。
key-value存储 使用方式: put(k, v) & get(k) 常见的数据结构：LSM-Tree 产品：rocksdb
分布式存储 分布式存储：在单机存储基础上实现了分布式协议，涉及大量网络交互。
分布式文件系统 HDFS，Ceph
单机关系型数据库 Oracle、MySQL、PostgreSQL。
通用组件：
Query Engine：解析query，生成查询计划 Txn Manager：负责事务并发管理 Lock Manager：负责锁相关的策略 Storage Engine：负责组织内存、磁盘数据结构 Replication：负责主备同步 关键内存数据结构：B-Tree、B+-Tree、LRU List"><meta itemprop=datePublished content="2022-06-03T14:13:26+08:00"><meta itemprop=dateModified content="2022-06-03T14:13:26+08:00"><meta itemprop=wordCount content="136"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="带你认识存储数据库"><meta name=twitter:description content="经典案例 数据的持久化 校验数据的合法性 修改内存（用高效的数据结构组织数据） 写入存储介质（以寿命&性能友好的方式写入硬件） 潜在问题 数据库怎么保证数据不丢 数据库怎么处理多人同时修改的问题 为什么用数据库，除了数据库还能存到别的存储系统吗 数据库只能处理结构化数据吗 有哪些操作数据库的方式，要用什么编程语言 存储 & 数据库简介 存储系统 一个提供了读写、控制类接口，能够安全有效地把数据持久化的软件，就可以称为存储系统。
特点：性能敏感、代码简单又复杂、容易受硬件影响。
数据库 关系：任意元素组成的若干有序偶对
SQL：一种DSL，方便人类阅读的关系代数的表达形式
关系型数据库 数据化结构友好、支持事务、支持复杂查询语言SQL。
非关系型数据库 一般不要求严格的结构化。 半结构化数据友好、可能支持事务、可能支持复杂查询语言。
数据库 VS 经典存储 结构化数据关系 关系型数据库以表形式管理。
写入文件，自定义行，管理结构。
事务能力 数据库支持事务：
Atomicity：事务内的操作要么全做，要么不做。 Consistency，事务执行前后，数据状态是一致的。 Isolation，可以隔离多个并发事务，避免影响。 Durability，事务一旦提交成功，数据保证持久性。 复杂查询能力 SQL VS 编程语言
主流产品剖析 单机存储 单机存储：单个计算机节点上的存储软件系统，一般不涉及网络交互。
本地文件系统 文件系统接口：Ext2/3/4，sysfs，rootfs等，都遵循VFS的统一抽象接口。
Index Node: 记录文件元数据，如ID，大小、权限、位置等。inode是一个文件的唯一标识，会被存储到磁盘上，inode的总数在格式化文件系统时就固定了。 Directory Entry: 记录文件名、inode指针、层级关系等。dentry是内存结构，与inode的关系是N:1。
key-value存储 使用方式: put(k, v) & get(k) 常见的数据结构：LSM-Tree 产品：rocksdb
分布式存储 分布式存储：在单机存储基础上实现了分布式协议，涉及大量网络交互。
分布式文件系统 HDFS，Ceph
单机关系型数据库 Oracle、MySQL、PostgreSQL。
通用组件：
Query Engine：解析query，生成查询计划 Txn Manager：负责事务并发管理 Lock Manager：负责锁相关的策略 Storage Engine：负责组织内存、磁盘数据结构 Replication：负责主备同步 关键内存数据结构：B-Tree、B+-Tree、LRU List"></head><body class=not-ready data-menu=true><header class=header><p class=logo><a class=site-name href=https://magiconline.github.io/>魔法张的Blog</a><a class=btn-dark></a></p><script>let bodyClx=document.body.classList,btnDark=document.querySelector('.btn-dark'),sysDark=window.matchMedia('(prefers-color-scheme: dark)'),darkVal=localStorage.getItem('dark'),setDark=e=>{bodyClx[e?'add':'remove']('dark'),localStorage.setItem('dark',e?'yes':'no')};setDark(darkVal?darkVal==='yes':sysDark.matches),requestAnimationFrame(()=>bodyClx.remove('not-ready')),btnDark.addEventListener('click',()=>setDark(!bodyClx.contains('dark'))),sysDark.addEventListener('change',e=>setDark(e.matches))</script><nav class=menu><a href=/about/>关于</a></nav><nav class=social><a class=github style=--url:url(./github.svg) href=https://github.com/magiconline target=_blank></a></nav></header><main class=main><article class=post-single><header class=post-title><p><time>Jun 3, 2022</time></p><h1>带你认识存储数据库</h1></header><section class=post-content><h1 id=经典案例>经典案例</h1><h2 id=数据的持久化>数据的持久化</h2><ol><li>校验数据的合法性</li><li>修改内存（用高效的数据结构组织数据）</li><li>写入存储介质（以寿命&性能友好的方式写入硬件）</li></ol><h2 id=潜在问题>潜在问题</h2><ul><li>数据库怎么保证数据不丢</li><li>数据库怎么处理多人同时修改的问题</li><li>为什么用数据库，除了数据库还能存到别的存储系统吗</li><li>数据库只能处理结构化数据吗</li><li>有哪些操作数据库的方式，要用什么编程语言</li></ul><h1 id=存储--数据库简介>存储 & 数据库简介</h1><h2 id=存储系统>存储系统</h2><p>一个提供了读写、控制类接口，能够安全有效地把数据持久化的软件，就可以称为存储系统。<br>特点：性能敏感、代码简单又复杂、容易受硬件影响。</p><h2 id=数据库>数据库</h2><p>关系：任意元素组成的若干有序偶对<br>SQL：一种DSL，方便人类阅读的关系代数的表达形式</p><h3 id=关系型数据库>关系型数据库</h3><p>数据化结构友好、支持事务、支持复杂查询语言SQL。</p><h3 id=非关系型数据库>非关系型数据库</h3><p>一般不要求严格的结构化。
半结构化数据友好、可能支持事务、可能支持复杂查询语言。</p><h2 id=数据库-vs-经典存储>数据库 VS 经典存储</h2><h3 id=结构化数据关系>结构化数据关系</h3><p>关系型数据库以表形式管理。<br>写入文件，自定义行，管理结构。</p><h3 id=事务能力>事务能力</h3><p>数据库支持事务：</p><ul><li>Atomicity：事务内的操作要么全做，要么不做。</li><li>Consistency，事务执行前后，数据状态是一致的。</li><li>Isolation，可以隔离多个并发事务，避免影响。</li><li>Durability，事务一旦提交成功，数据保证持久性。</li></ul><h3 id=复杂查询能力>复杂查询能力</h3><p>SQL VS 编程语言</p><h1 id=主流产品剖析>主流产品剖析</h1><h2 id=单机存储>单机存储</h2><p>单机存储：单个计算机节点上的存储软件系统，一般不涉及网络交互。</p><h3 id=本地文件系统>本地文件系统</h3><p>文件系统接口：Ext2/3/4，sysfs，rootfs等，都遵循VFS的统一抽象接口。<br>Index Node: 记录文件元数据，如ID，大小、权限、位置等。inode是一个文件的唯一标识，会被存储到磁盘上，inode的总数在格式化文件系统时就固定了。
Directory Entry: 记录文件名、inode指针、层级关系等。dentry是内存结构，与inode的关系是N:1。</p><h3 id=key-value存储>key-value存储</h3><p>使用方式: put(k, v) & get(k)
常见的数据结构：LSM-Tree
产品：rocksdb</p><h2 id=分布式存储>分布式存储</h2><p>分布式存储：在单机存储基础上实现了分布式协议，涉及大量网络交互。</p><h3 id=分布式文件系统>分布式文件系统</h3><p>HDFS，Ceph</p><h2 id=单机关系型数据库>单机关系型数据库</h2><p>Oracle、MySQL、PostgreSQL。<br>通用组件：</p><ul><li>Query Engine：解析query，生成查询计划</li><li>Txn Manager：负责事务并发管理</li><li>Lock Manager：负责锁相关的策略</li><li>Storage Engine：负责组织内存、磁盘数据结构</li><li>Replication：负责主备同步</li></ul><p>关键内存数据结构：B-Tree、B+-Tree、LRU List<br>关键磁盘数据结构：WriteAheadLog(Redo Log)、page</p><h2 id=单机非关系型数据库>单机非关系型数据库</h2><p>MongoDB、Redis、Elasticsearch<br>关系型数据库一般直接使用SQL交互，而非关系型数据库交互方式各不相同。</p><ul><li>ElasticSearch<ul><li>面向文档存储</li><li>文档可序列化成JSON</li><li>存在index（文档的集合）</li><li>存储和构建索引能力以来搜索引擎</li><li>实现了大量搜索数据结构&算法</li><li>支持RESTFUL API，支持弱SQL交互</li></ul></li><li>MongoDB<ul><li>面向文档存储</li><li>文档可序列化成JSON/BSON</li><li>存在collection</li><li>依赖wiredTiger引擎</li><li>4.0后开始支持事务</li><li>常用client/SDK交互，可以支持弱SQL</li></ul></li><li>Redis<ul><li>数据结构丰富(hash表、set、zset、list)</li><li>C实现，炒高性能</li><li>基于内存，支持AOF、RDB持久化</li><li>常用redis-cli、多语言交互</li></ul></li></ul><p>跟关系型数据库相比，ES天然支持模糊搜索，还能自动算出关联程度。</p><h2 id=分布式数据库>分布式数据库</h2><p>单机数据库遇到的问题：容量、弹性、性价比</p><h3 id=解决容量问题>解决容量问题</h3><p>单点容量有限，受硬件限制。
分布式存储节点池化，动态扩缩容。</p><h3 id=解决弹性问题>解决弹性问题</h3><p>可以扩缩容</p><h3 id=解决性价比问题>解决性价比问题</h3><p>按需扩容（CPU、内存、存储）</p><h3 id=more>More</h3><p>单写VS多写，从磁盘弹性到内存弹性，分布式事务优化</p><h1 id=新技术演进>新技术演进</h1><h2 id=bypass-os-kernel>Bypass OS kernel</h2><ul><li>避免系统调用带来的性能损耗，直接从用户态访问磁盘。</li><li>磁盘性能提高后，中断次数随之上升，不利于IO性能。</li><li>SPDK 绑定特定CPU核用轮询代替中断</li><li>使用无锁队列，降低并发开销</li></ul><h2 id=ai>AI</h2><p>AI决策，行列混存</p><h2 id=高性能硬件>高性能硬件</h2><h3 id=rdma网络>RDMA网络</h3><p>不经过传统的网络协议栈，把用户态虚拟内存映射给网卡，减少拷贝、CPU开销。</p><h3 id=persistent-memory>Persistent Memory</h3><p>IO时延介于SSD与内存之间，可以用作内存或持久化介质。</p><h3 id=可编程交换机>可编程交换机</h3><p>在交换机层对网络包做计算逻辑，在数据库场景下实现缓存一致性协议等。</p><h3 id=cpugpudpu>CPU/GPU/DPU</h3><p>众核、显存、异构计算</p></section><nav class=post-nav><a class=next href=https://magiconline.github.io/post/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/><span>分布式定时任务</span><span>→</span></a></nav></article></main><footer class=footer><p>&copy; 2022 <a href=https://magiconline.github.io/>魔法张的Blog</a></p><p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p><p><a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a></p></footer></body></html>